import { DocumentItem } from '../model/DocumentItem'

export class DocumentUtils {
  // æ£€æŸ¥è¯ä»¶æ˜¯å¦å³å°†è¿‡æœŸï¼ˆ30å¤©å†…ï¼‰
  static isExpiringSoon(expiryDate: string): boolean {
    const expiry = new Date(expiryDate)
    const today = new Date()
    const diffTime = expiry.getTime() - today.getTime()
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))
    return diffDays <= 30 && diffDays > 0
  }

  // æ£€æŸ¥è¯ä»¶æ˜¯å¦å·²è¿‡æœŸ
  static isExpired(expiryDate: string): boolean {
    const expiry = new Date(expiryDate)
    const today = new Date()
    return expiry < today
  }

  // æ ¼å¼åŒ–è¯ä»¶å·ç ï¼ˆéšè—ä¸­é—´éƒ¨åˆ†ï¼‰
  static formatDocumentNumber(number: string): string {
    if (number.length <= 8) {
      return number
    }
    const start = number.substring(0, 4)
    const end = number.substring(number.length - 4)
    return `${start}****${end}`
  }

  // è·å–è¯ä»¶ç±»å‹å›¾æ ‡
  static getDocumentTypeIcon(type: string): string {
    switch (type) {
      case 'èº«ä»½è¯':
        return 'ğŸ†”'
      case 'æŠ¤ç…§':
        return 'ğŸ“˜'
      case 'é©¾é©¶è¯':
        return 'ğŸš—'
      default:
        return 'ğŸ“„'
    }
  }

  // è·å–è¯ä»¶çŠ¶æ€é¢œè‰²
  static getDocumentStatusColor(expiryDate: string): string {
    if (DocumentUtils.isExpired(expiryDate)) {
      return '#F44336' // çº¢è‰² - å·²è¿‡æœŸ
    } else if (DocumentUtils.isExpiringSoon(expiryDate)) {
      return '#FF9800' // æ©™è‰² - å³å°†è¿‡æœŸ
    } else {
      return '#4CAF50' // ç»¿è‰² - æ­£å¸¸
    }
  }

  // è·å–è¯ä»¶çŠ¶æ€æ–‡æœ¬
  static getDocumentStatusText(expiryDate: string): string {
    if (DocumentUtils.isExpired(expiryDate)) {
      return 'å·²è¿‡æœŸ'
    } else if (DocumentUtils.isExpiringSoon(expiryDate)) {
      return 'å³å°†è¿‡æœŸ'
    } else {
      return 'æ­£å¸¸'
    }
  }

  // éªŒè¯è¯ä»¶å·ç æ ¼å¼
  static validateDocumentNumber(type: string, number: string): boolean {
    switch (type) {
      case 'èº«ä»½è¯':
        // èº«ä»½è¯å·ç éªŒè¯ï¼ˆç®€åŒ–ç‰ˆï¼‰
        return /^\d{17}[\dXx]$/.test(number)
      case 'æŠ¤ç…§':
        // æŠ¤ç…§å·ç éªŒè¯ï¼ˆç®€åŒ–ç‰ˆï¼‰
        return /^[A-Z]\d{8}$/.test(number)
      case 'é©¾é©¶è¯':
        // é©¾é©¶è¯å·ç éªŒè¯ï¼ˆç®€åŒ–ç‰ˆï¼‰
        return /^\d{18}$/.test(number)
      default:
        return number.length > 0
    }
  }

  // ç”Ÿæˆè¯ä»¶äºŒç»´ç æ•°æ®
  static generateQRCodeData(document: DocumentItem): string {
    return JSON.stringify({
      id: document.id,
      name: document.name,
      type: document.type,
      number: document.number,
      expiryDate: document.expiryDate
    })
  }
}
